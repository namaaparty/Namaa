import Link from "next/link"
import { createClient as createServiceClient } from "@supabase/supabase-js"

import { SiteNavbar } from "@/components/site-navbar"
import { SiteFooter } from "@/components/site-footer"
import { Button } from "@/components/ui/button"
import { FileDown } from "lucide-react"
import { createClient as createServerSupabase } from "@/lib/supabase/server"
import { getPageContent } from "@/lib/pages-storage"

export const revalidate = 60 // Cache for 60 seconds

async function getLatestPdfUrl() {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY

  const supabase =
    supabaseUrl && serviceRoleKey
      ? createServiceClient(supabaseUrl, serviceRoleKey)
      : await createServerSupabase()

  if (!supabaseUrl || !serviceRoleKey) {
    console.warn("[constitution] SUPABASE_SERVICE_ROLE_KEY not provided, falling back to session client")
  }

  const { data, error } = await supabase
    .from("constitution_documents")
    .select("file_url")
    .order("uploaded_at", { ascending: false })
    .limit(1)
    .single()

  if (error) {
    console.error("[constitution] Failed to fetch pdf:", error)
  }

  return data?.file_url || null
}

const content = `
"إن التحديث والتطوير من سمات الدول والشعوب الحية، وشعبنا الأردني العزيز كان دوما في مقدمة الشعوب الطامحة للتقدم والإصلاح، وإنني لأشعر بالفخر بما أنجز بلدنا في مسيرته الطويلة، مثلما أشعر بواجب المسؤولية في مواصلة عملية التطوير لضمان حق الأردنيين والأردنيات في ممارسة حياة برلمانية وحزبية ترقى بديمقراطيتهم وحياتهم، وتسهم في تحقيق أمنياتهم، مع دخول الدولة مئويتها الثانية."

رسالة جلالة الملك عبدالله الثاني ، لتشكيل اللجنة الملكية لتحديث المنظومة السياسية

الجزء الأول: المبادئ والأهداف والوسائل

الفصل الأول: الاسم والهوية

المادة (1): يسمى هذا النظام "النظام الأساسي لحزب نماء" ويعمل به من تاريخ اقراره وفقا لأحكام القانون.

المادة (2): التعريفات
يكون للكلمات والعبارات التالية حيثما وردت المعاني المخصصة إزاء كل منها:
المملكة: المملكة الاردنية الهاشمية
الحزب: حزب نماء.
الهيئة العامة: كافة أعضاء الحزب
المؤتمر: المؤتمر العام للحزب.
الأمانة العامة: الامانة العامة للحزب .
المجلس الوطني: المجلس الوطني للحزب.
مجلس الحكماء: مجلس الحكماء للحزب
المجلس المركزي: المجلس المركزي للحزب .
الأمين العام: أمين عام الحزب .
العضو: العضو المنتسب للحزب .
الفرع: فرع الحزب في المنطقة المعينة .
القانون: قانون الأحزاب السياسية، رقم 7 لسنة 2022
المحكمة: محكمة الحزب.
القطاعات: اللجان التي تشكل بمختلف القطاعات لتنفيذ رؤية ورسالة واهداف الحزب.

المادة (3): حزب نماء هو حزب سياسي أردني وفقا للمادة الثالثة من القانون .

المادة (4): المقر الرئيسي للحزب العاصمة عمان، وله الحق في فتح فروع أخرى داخل حدود المملكة الأردنية الهاشمية .

المادة (5): شعار الحزب كلمة "نماء" امتدادا للعلم الأردني رمز الوطنية والانتماء يتوسط هذا الشعار نجمة العلم الأردني السباعية.

المادة (6): يتبنى الحزب الرؤية والرسالة التاليتين :
رؤية الحزب: تمكين المجتمع الأردني لبناء اقتصاد وطني قوي بما يعزز المنعة السياسية للمملكة.
الرسالة: شحذ الهمم وتكاتف الجهود على أساس المواطنة لتمكين المجتمع الأردني وتحقيق نهضته وفقا لقيم ثوابت الأمة.

الفصل الثاني: المرجعيات والثوابت
المادة (7): مرجعيات الحزب:
1- الدستور الأردني.
2- التشريعات النافذة.
3- الهوية الوطنية الأردنية.
4- التراث الإنساني والحضاري للمملكة.

المادة (8): ثوابت الحزب
الحفاظ على الدولة الأردنية المستقلة والمستقرة؛ باعتبارها منجزا لكل الأردنيين، ومؤسسة العرش الهاشمي.

الفصل الثالث: مبادئ ومنطلقات الحزب

المادة (9): ينطلق الحزب في رؤيته ورسالته من المبادئ الآتية :
1- الالتزام بالدستور الأردني، وسيادة القانون والحريات العامة.
2- ارساء دعائم الديمقراطية ودعم التعددية السياسية .
3- تمكين المؤسسات العامة لخدمة المواطنين وضمان حقوقهم.
4- تبني مبدأ الجدارة في تولية الأكفأ بين جميع المواطنين بعيدا عن الواسطة والمحسوبية.
5- تحقيق العدالة والمساواة التامة بين جميع الأردنيين.
6- الحوار الهادف واحترام الرأي والرأي الآخر وضمان حرية التعبير والحريات الصحافية.
7- تفعيل مبدأ الديمقراطية والشفافية والكفاءة والثقة والاحترام المتبادل في إدارة شؤون الحزب .
8- ضمان الحقوق الأساسية للمواطنين ومتابعتها.
9- تعزيز الترابط الوثيق بين القطاعات الاقتصادية من جهة والسياسية والاجتماعية من جهة أخرى.

الفصل الرابع: الغايات والأهداف .
المادة (10): يسعى الحزب إلى تحقيق الغايات والأهداف الآتية :
1- تطوير منظومة اقتصادية شاملة للقطاعات كافة، ممنهجة على أساس علمي ومهني متدرجة عبر حزمة من البرامج المتسلسلة تنهض بالاقتصاد الوطني، أساسها التنمية، وغايتها النهضة، تحقق التنمية المستدامة، وتخلق مناخ استثماري مميز وجاذب، وتطوع التشريعات اللازمة لتحقيق شراكة حقيقية وفاعلة بين القطاعين العام والخاص سعيا لتحسين مستوى الصحة والتعليم والنقل وللحد من مشكلات الفقر والبطالة.
2- تسخير امكانيات الحزب كافة للإسهام في بناء الدولة الأردنية الديمقراطية الحديثة.
3- تتظافر جهود الحزب ويتكاتف أعضاؤه مع أي جهود وطنية تسعى للتصدي لأي محاولة لاستهداف أمن الوطن على المستويات كافة والمحافظة على وحدة أراضيه.
4- المشاركة في تشكيل الحكومات.
5- تعزيز أدوات النزاهة ومحاربة الفساد .
6- تمكين الشباب من التعلم والعمل والمشاركة السياسية وحمايتهم من مظاهر التعصب والتطرف والسلبية والانحلال وتعزيز القيم الوطنية لديهم .
7- تمكين المرأة وتعزيز دورها .
8- السعي لتطوير دور النقابات والاتحادات ومؤسسات المجتمع المدني، ومؤسسات العمل التطوعي.
9- السعي لتطوير الجامعات وتعزيز دورها البحثي والمجتمعي ودعم المواهب والإبداع والأدب والثقافة والفنون.
10- السعي لحماية السيادة الوطنية والأمن الوطني الشامل.
11- وضع برامج من شانها الحفاظ على الثروات والمصادر الطبيعية بما يضمن التوزيع العادل للثروة منعا للاستغلال الجائر والمحافظة على البيئة بشكل سليم .
12- تعزيز استقلال القضاء وتطويره وحمايته.

الفصل الخامس: السياسات العامة والوسائل .

أ- السياسات العامة:
المادة (11): يتبنى الحزب لتحقيق أهدافه وغاياته السياسات العامة التالية :
1- بناء التحالفات الحزبية مع جميع الاطياف السياسية والاجتماعية، بما يسهم في تحقيق أهداف الحزب.
2- الانطلاق من العمل المدروس والممنهج والعملي للنهوض في برامج الحزب، والمنظم من خلال القطاعات الحزبية .
3- تحفيز الشباب والاعتماد على الموارد البشرية للنهوض بالوطن ومؤسساته.
4- التدرج بتطبيق البرامج التنموية واشراك أكبر للمؤسسات الوطنية الخدماتية.
5- التشارك مع المؤسسات المختلفة بشكل فاعل، والتواصل مع أصحاب القرار في جميع مواقع المسؤولية والمستويات كافة .
6- تقديم الحالة التوافقية قبل الدخول في الحالة التنافسية، وصولا للديمقراطية الشاملة .
7- متابعة عمل الحكومات من خلال اللجان المشكلة باعتبارها الذراع التنفيذي للحزب.
8- الالتزام بكافة المواثيق والمعاهدات والاتفاقيات الدولية، التي ترتبط بها الدولة الأردنية.
9- تكون هذه السياسات ضمن الأطر القانونية والتشريعات النافذة .
10- تبني الإصلاحات البناءة على الصعد كافة السياسية والاقتصادية والاجتماعية والثقافية.

ب- الوسائل
المادة (12): يعتمد الحزب لتحقيق أهدافه على الوسائل الآتية :
1- برنامج اقتصادي شامل، ووضع الأطر التنفيذية والتشاركية وتسخير الإمكانات اللازمة للتنفيذ
2- اعداد البرامج التنفيذية على أسس مؤسسية تحقق الحوكمة ومعايير الجودة.
3- تطوير وتنمية القدرات التنظيمية للأعضاء عبر عمليات التثقيف الحزبي والحوار والتأهيل والتدريب .
4- إنشاء مركز للدراسات الاستشارية.
5- تطوير قنوات اتصال فعالة بين أعضاء الحزب لتعزيز المشاركة في صنع القرار.
6- استخدام وسائل الإعلام المختلفة لإيصال أفكار الحزب ومواقفه للمواطنين.
7- استخدام أدوات التكنولوجيا الحديثة والذكاء الاصطناعي واستخدامها بالأطر القانونية وتسخيرها لخدمة أهداف الحزب .

الجزء الثاني: العضوية، والقيادة الحزبية

الفصل الأول: العضوية وشروطها.
المادة (13): عضوية الحزب مفتوحة لكل الأردنيين وفقا لأحكام النظام، وبحسب ما ورد بالمادة 6 ب من القانون.

المادة (14): يكتسب الشخص عضوية الحزب بالإجراءات التالية:
1- يتقدم الراغب بالانضمام للحزب في مرحلة التأسيس بطلب خطي وفق ا للنموذج المعد لهذه الغاية يقر فيه باطلاعه وموافقته على النظام الأساسي للحزب، واستعداده لدفع الالتزامات المالية المترتبة عليه بموجب النظام واللوائح الصادرة بمقتضاه.
2- يتقدم العضو المنتسب للحزب بعد انعقاد المؤتمر التأسيسي برغبته بالانضمام من خلال تقديم صورة عن هوية الأحوال المدنية لدائرة العضوية وتعبئة النموذج الورقي او الكتروني المعد لهذه الغاية.
3- تصادق الأمانة العامة على قبول العضوية بعد تنسيب من دائرة العضوية للطلبات الواردة لها من الفرع او تزكية احد أعضاء المجلس المركزي وتصديق رئيس مجلس المحافظة على النموذج.
4- يصبح الشخص عضوا في الحزب بعد موافقة الأمين العام.

المادة (15): حقوق العضوية:
• الترشح والانتخاب داخل هيئات الحزب وفق أحكام هذا النظام والتعليمات الصادرة عن الحزب.
• المشاركة في إقرار سياسات الحزب ووسائله ومناقشة خطته ضمن الأطر التنظيمية.
• إبداء الرأي وتقديم الاقتراحات ومناقشة أمور الحزب حسب موقعه التنظيمي.
• التظلم والتقاضي لدى المحكمة حسب اللوائح الخاصة بها.
• الاستفادة من الفرص المتاحة لتطوير قدراته وإمكانياته.
• دفاع الحزب عنه وعن حقوقه كمواطن وناشط سياسي.
• المشاركة في الانتخابات العامة وتولي الوظائف والمهام وفقا لأحكام هذا النظام والتعليمات الصادرة عن الحزب.
• الاستقالة.`

export default async function ConstitutionPage() {
  const pdfUrl = await getLatestPdfUrl()
  
  // Fetch editable content from database
  const pageData = await getPageContent("constitution")
  const constitutionContent = pageData?.sections?.find(s => s.title === "محتوى النظام الأساسي")?.content || content

  return (
    <main dir="rtl" className="min-h-screen bg-gradient-to-b from-background to-muted/10">
      <SiteNavbar />
      <div className="h-20" />
      <div className="max-w-5xl mx-auto px-6 py-12 space-y-10">
        <div className="text-center space-y-3">
          <h1 className="text-4xl font-bold">النظام الرئيسي</h1>
          <p className="text-lg text-muted-foreground">حزب نماء</p>
        </div>

        <section className="space-y-6">
          <div className="flex flex-col gap-4 md:flex-row md:items-center md:justify-between bg-card border rounded-3xl shadow-sm p-6">
            <div className="space-y-1">
              <p className="text-xl font-semibold">قراءة أو تحميل النسخة الكاملة</p>
              <p className="text-muted-foreground">يمكنك الاطلاع على النظام الأساسي أو تحميله بصيغة PDF.</p>
            </div>
            <div className="flex flex-wrap gap-3">
              {pdfUrl ? (
                <Button asChild className="gap-2">
                  <a href={pdfUrl} target="_blank" rel="noopener noreferrer" download>
                    <FileDown className="w-4 h-4" />
                    تنزيل النظام الاساسي
                  </a>
                </Button>
              ) : (
                <Button variant="secondary" disabled className="gap-2 opacity-70">
                  <FileDown className="w-4 h-4" />
                  لا يوجد ملف متاح
                </Button>
              )}
            </div>
          </div>

          <div
            id="constitution-content"
            className="bg-card border rounded-3xl shadow-sm p-8 leading-loose text-lg whitespace-pre-line text-muted-foreground"
          >
            {constitutionContent}
          </div>
        </section>

      </div>

      <SiteFooter />
    </main>
  )
}

